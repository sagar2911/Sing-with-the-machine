(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{104:function(e,n,t){"use strict";t.r(n);var a=t(1),r=t.n(a),o=t(4),s=t.n(o),l=(t(45),t(11)),i=t(12),c=t(15),u=t(13),h=t(14),d=t(6);t(46),t(47);function m(e){if(!e)throw new Error("Invalid filename");return fetch(e).then(function(e){return e.arrayBuffer()})}var p=t(8),f=function(e){function n(e){var t;return Object(l.a)(this,n),(t=Object(c.a)(this,Object(u.a)(n).call(this,e))).state={hasLoadedFile:!1,loadedFileName:""},t.handleFileInput=t.handleFileInput.bind(Object(d.a)(Object(d.a)(t))),t}return Object(h.a)(n,e),Object(i.a)(n,[{key:"handleFileInput",value:function(e){var n=this;console.log("Welcome handleFileInput"),function(e){if(e)return new Promise(function(n,t){var a=new FileReader;a.onload=n,a.onerror=t,a.readAsText(e)}).then(function(e){return e.target.result.replace(/(\r\n|\n|\r)/gm," ")})}(e).then(function(t){n.props.fileHandler(e.name,t)})}},{key:"render",value:function(){return r.a.createElement("div",{id:"welcome"},r.a.createElement("h1",null,"Sing With The Machine"),r.a.createElement(p.b,{style:{maxWidth:500}},r.a.createElement(p.d,{title:"Welcome!"}),r.a.createElement(p.c,null,r.a.createElement("p",null,'This tool generates music for narratives. Simply load a text file and it will be parsed into mood chunks which will then have music generated for them. After that, press "Play" and start enjoying a musical piece set to match the exact text you\'re reading!'),r.a.createElement("h3",null,"Load a text file"),r.a.createElement(p.e,{id:"game-file",onChange:this.handleFileInput,name:"images",secondary:!0}),r.a.createElement("br",null),r.a.createElement("label",{style:{marginTop:"40px"}},this.props.loadedFilename),r.a.createElement("br",null),r.a.createElement("br",null),this.props.hasLoadedFile?r.a.createElement(p.a,{raised:!0,onClick:this.props.play,primary:!0},"Play"):"")))}}]),n}(a.Component),y=(t(89),t(38)),g=t.n(y),k=t(20),v=t.n(k),b=function(e){function n(e){var t;Object(l.a)(this,n),(t=Object(c.a)(this,Object(u.a)(n).call(this,e))).state={currentChunkIdx:0,transitioning:!1,chunksToDisplay:[t.props.chunks[0]]},t.startPlayer=t.startPlayer.bind(Object(d.a)(Object(d.a)(t))),t.pianoInstrument=null,t.bassInstrument=null,t.percussionInstrument=null,t.ac=new AudioContext;var a=v.a.instrument(t.ac,"/acoustic_grand_piano.js").then(function(e){t.pianoInstrument=e}),r=v.a.instrument(t.ac,"/acoustic_bass.js").then(function(e){t.bassInstrument=e}),o=v.a.instrument(t.ac,"/woodblock.js").then(function(e){t.percussionInstrument=e});return a.then(function(){return r}).then(function(){return o}).then(function(){m("test1.midi").then(function(e){t.midiData=e,t.startPlayer(e)}).catch(function(e){console.log(e),console.log("Error getting MIDI file from server")})}),t.advanceToNextChunk=t.advanceToNextChunk.bind(Object(d.a)(Object(d.a)(t))),t}return Object(h.a)(n,e),Object(i.a)(n,[{key:"startPlayer",value:function(e){var n=this;this.player&&this.player.isPlaying()&&this.player.stop(),this.player=new g.a.Player(function(e){"Note on"===e.name&&n.pianoInstrument.play(e.noteName,n.ac.currentTime,{gain:e.velocity/100})}),this.player.on("endOfFile",function(){console.log("end of file reached"),n.startPlayer(n.midiData)}),this.player.loadArrayBuffer(e),this.player.play()}},{key:"advanceToNextChunk",value:function(){var e=this;console.log(this.state.chunksToDisplay),this.setState({transitioning:!0}),m("test"+(this.state.currentChunkIdx+2)+".midi").then(function(n){e.midiData=n,e.startPlayer(n);var t=e.state.chunksToDisplay.slice();t.push(e.props.chunks[e.state.currentChunkIdx+1]),e.setState({currentChunkIdx:e.state.currentChunkIdx+1,transitioning:!1,chunksToDisplay:t})}).catch(function(n){console.log("Error getting MIDI file from server");var t=e.state.chunksToDisplay.slice();t.push(e.props.chunks[e.state.currentChunkIdx]),e.setState({currentChunkIdx:e.state.currentChunkIdx+1,transitioning:!1,chunksToDisplay:t})})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{id:"game-play",className:"GamePlay"},this.state.chunksToDisplay.map(function(n,t){return r.a.createElement("div",{className:"chunk",key:n.lastSentenceIdx},r.a.createElement(p.b,{style:{width:500}},r.a.createElement(p.c,null,function(){console.log("current chunk idx: "+e.state.currentChunkIdx);var a=0;t>0&&(a=e.state.chunksToDisplay[t-1].lastSentenceIdx+1);var r=n.lastSentenceIdx;t===e.props.chunks.length-1&&r--,console.log("sentence indices: "+a+" "+r);for(var o="",s=a;s<=r;s++)o+=e.props.sentences[s]+". ";return o}()),e.state.currentChunkIdx+1<e.props.chunks.length&&e.state.currentChunkIdx===t?r.a.createElement(p.a,{secondary:!0,raised:!0,onClick:e.advanceToNextChunk},e.state.transitioning?"Transitioning...":"Next"):""),r.a.createElement(p.b,{style:{width:500}},r.a.createElement(p.c,null,"Valence: ",n.valence,r.a.createElement("br",null),"Arousal: ",n.arousal,r.a.createElement("br",null),"Dominance: ",n.dominance)))}))}}]),n}(a.Component),I=function(e){function n(e){var t;return Object(l.a)(this,n),(t=Object(c.a)(this,Object(u.a)(n).call(this,e))).state={hasLoadedFile:!1,playing:!1,chunks:[],sentences:[]},t.handleFileInput=t.handleFileInput.bind(Object(d.a)(Object(d.a)(t))),t.play=t.play.bind(Object(d.a)(Object(d.a)(t))),t}return Object(h.a)(n,e),Object(i.a)(n,[{key:"handleFileInput",value:function(e,n){console.log(e,n);var t=n.split(". ");t=t.filter(function(e){return e.length>0}),console.log(t),console.log("num sentences: "+t.length),this.setState({hasLoadedFile:!0,loadedFilename:e,sentences:t})}},{key:"play",value:function(){var e=this;fetch("/generateMusic",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({sentences:this.state.sentences})}).then(function(e){return e.json()}).then(function(n){console.log("Music has been generated"),console.log(n),e.setState({playing:!0,chunks:n.chunks})}).catch(function(n){console.log("There was an error"),e.setState({playing:!0,chunks:[{valence:9*Math.random(),arousal:9*Math.random(),dominance:9*Math.random(),lastSentenceIdx:4},{valence:9*Math.random(),arousal:9*Math.random(),dominance:9*Math.random(),lastSentenceIdx:5},{valence:9*Math.random(),arousal:9*Math.random(),dominance:9*Math.random(),lastSentenceIdx:7},{valence:9*Math.random(),arousal:9*Math.random(),dominance:9*Math.random(),lastSentenceIdx:8},{valence:9*Math.random(),arousal:9*Math.random(),dominance:9*Math.random(),lastSentenceIdx:10},{valence:9*Math.random(),arousal:9*Math.random(),dominance:9*Math.random(),lastSentenceIdx:12}]})})}},{key:"render",value:function(){return r.a.createElement("div",{className:"App"},this.state.playing?r.a.createElement(b,{chunks:this.state.chunks,sentences:this.state.sentences}):r.a.createElement(f,{fileHandler:this.handleFileInput,play:this.play,loadedFilename:this.state.loadedFilename,hasLoadedFile:this.state.hasLoadedFile}))}}]),n}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var x=t(39);t.n(x).a.load({google:{families:["Roboto:300,400,500,700","Material Icons"]}}),s.a.render(r.a.createElement(I,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},40:function(e,n,t){e.exports=t(104)},45:function(e,n,t){},46:function(e,n,t){},47:function(e,n,t){},89:function(e,n,t){}},[[40,1,2]]]);
//# sourceMappingURL=main.593ddb68.chunk.js.map